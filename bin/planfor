#!/usr/bin/env node

let {
    startClient, launchServer
} = require('..');
let yargs = require('yargs');
let path = require('path');
let log = console.log; // eslint-disable-line

const help = `Usage: planfor server
    --port [port]

Usage: planfor load
    --port [port]
    --hostname [hostname]
    --config [plan config json path]
    `;

yargs.usage(help).demandOption([]).help('h').alias('h', 'help');

let {
    argv
} = yargs;

let action = argv._[0];

let runCommand = async() => {
    if (action === 'server') {
        launchServer(argv.port);
    } else if (action === 'load') {
        let {
            loadPlan
        } = startClient(argv.hostname, argv.port);

        return loadPlan(getConfigPath(argv.config));
    } else {
        throw new Error(`unrecognized action ${action},\n${help}`);
    }
};

let getConfigPath = () => {
    let configPath = argv.config || 'plan.json';
    return getParamPath(configPath);
};

let getParamPath = (p) => {
    return path.resolve(process.cwd(), p);
};

runCommand().catch(err => {
    log(err.toString());
    process.exit(1);
});
